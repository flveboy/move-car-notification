<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«ç æŒªè½¦æœåŠ¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e88e5 0%, #0d47a1 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: #1565c0;
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .description {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            background: #ff9800;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            color: white;
        }
        
        .content {
            padding: 25px 20px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 18px;
            color: #1565c0;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e3f2fd;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 20px;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-size: 16px;
            transition: border-color 0.3s;
            margin-bottom: 10px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }
        
        .char-count {
            text-align: right;
            color: #757575;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .char-count.warning {
            color: #f44336;
        }
        
        .templates {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .template-btn {
            background: #e3f2fd;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #1565c0;
            transition: all 0.3s;
        }
        
        .template-btn:hover {
            background: #bbdefb;
            transform: translateY(-2px);
        }
        
        .template-btn.active {
            background: #1565c0;
            color: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 16px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .notify-btn {
            background: #2196f3;
            color: white;
        }
        
        .notify-btn:hover {
            background: #1976d2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }
        
        .notify-btn:disabled {
            background: #90caf9;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .call-btn {
            background: #4caf50;
            color: white;
        }
        
        .call-btn:hover {
            background: #388e3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            display: none;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            display: block;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            display: block;
        }
        
        .qrcode-section {
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
            border-top: 1px solid #eee;
        }
        
        #qrcode {
            display: inline-block;
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .qrcode-instructions {
            font-size: 14px;
            color: #616161;
            line-height: 1.5;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            font-size: 12px;
            color: #9e9e9e;
            background: #f5f5f5;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 480px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-car"></i>
            </div>
            <h1>æ‰«ç æŒªè½¦æœåŠ¡</h1>
            <p class="description">é’‰é’‰æŒªè½¦</p>
        </header>
        
        <div class="content">
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-comment-dots"></i>
                    å‘é€æŒªè½¦é€šçŸ¥
                </div>
                
                <textarea id="messageInput" placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹ï¼Œä¾‹å¦‚ï¼šæ‚¨å¥½ï¼Œæ‚¨çš„è½¦è¾†éœ€è¦æŒªåŠ¨ä¸€ä¸‹ï¼Œè°¢è°¢ï¼"></textarea>
                <div id="charCount" class="char-count">0/200</div>
                
                <div class="templates">
                    <button class="template-btn active" data-template="default">é»˜è®¤é€šçŸ¥</button>
                    <button class="template-btn" data-template="polite">ç¤¼è²Œç‰ˆ</button>
                    <button class="template-btn" data-template="urgent">ç´§æ€¥ç‰ˆ</button>
                    <button class="template-btn" data-template="police">äº¤è­¦ç‰ˆ</button>
                </div>
                
                <div class="action-buttons">
                    <button id="notifyBtn" class="btn notify-btn">
                        <i class="fas fa-paper-plane"></i>
                        å‘é€é’‰é’‰é€šçŸ¥
                    </button>
                    <button id="callBtn" class="btn call-btn">
                        <i class="fas fa-phone"></i>
                        ç›´æ¥æ‹¨æ‰“
                    </button>
                </div>
                
                <div id="statusMessage" class="status-message"></div>
            </div>
        </div>
        
        <footer>
            <p>Â© 2025 æ‰«ç æŒªè½¦æœåŠ¡ | é’‰é’‰æŒªè½¦</p>
        </footer>
    </div>

    <script>
        // å®šä¹‰æ¨¡æ¿æ¶ˆæ¯
        const messageTemplates = {
            default: 'æ‚¨å¥½ï¼Œæ‚¨çš„è½¦è¾†éœ€è¦æŒªåŠ¨ä¸€ä¸‹ï¼Œè°¢è°¢ï¼',
            polite: 'å°Šæ•¬çš„å…ˆç”Ÿ/å¥³å£«ï¼Œæ‚¨å¥½ï¼æ‚¨çš„çˆ±è½¦æŒ¡ä½äº†æˆ‘çš„å»è·¯ï¼Œéº»çƒ¦æ‚¨æŒªä¸€ä¸‹è½¦ï¼Œéå¸¸æ„Ÿè°¢ï¼',
            urgent: 'ç´§æ€¥æŒªè½¦é€šçŸ¥ï¼šæ‚¨çš„è½¦è¾†æŒ¡ä½äº†ç´§æ€¥é€šé“ï¼Œè¯·ç«‹å³å‰æ¥æŒªè½¦ï¼',
            police: 'äº¤è­¦æ¥äº†ï¼Œèµ¶ç´§æŒªè½¦ï¼è¯·ç«‹å³å‰æ¥å¤„ç†ï¼Œä»¥å…è¢«ç½šæ¬¾ï¼'
        };

        // é¢‘ç‡é™åˆ¶ - æ¯åˆ†é’Ÿæœ€å¤š10æ¬¡
        let requestTimestamps = [];
        const MAX_REQUESTS_PER_MINUTE = 10;
        
       // å¢å¼ºè„è¯è¿‡æ»¤ç³»ç»Ÿ
        const profanityFilter = {
            // åŸºç¡€è„è¯åˆ—è¡¨ - æ·»åŠ æ›´å¤šå˜ä½“
            basePatterns: [
                'å‚»é€¼', 'å‚»æ¯”', 'å‚»æ¯•', 'å‚»ç¬”', 'å‚»å¸', 'å‚»B', 'å‚»b', 'å‚»X', 'å‚»x',
                'SB', 'sb', 'sB', 'Sb', 'Sï¼¢', 'sï½‚', 'ï¼³B', 'ï½“b',
                'ç¥ç»ç—…', 'è„‘æ®‹', 'ç™½ç—´', 'æ··è›‹', 'ç‹å…«è›‹', 'æ“', 'æ—¥', 'å¦ˆçš„', 'å¦ˆé€¼',
                'fuck', 'shit', 'asshole', 'bitch', 'dick', 'pussy', 'cunt', 'bastard',
                // æ·»åŠ æ›´å¤šå­—æ¯å˜ä½“
                'shaé€¼', 'shaæ¯”', 'shaæ¯•', 'shaç¬”', 'shaå¸', 'shaB', 'shab', 'shaX', 'shax',
                'å‚»bi', 'å‚»b1', 'å‚»8', 'å‚»13', 'å‚»13', 'å‚»ä¸€ä¸‰'
            ],
            
            // ç‰¹æ®Šå­—ç¬¦å˜ä½“æ˜ å°„ - å¢å¼ºXå’Œxçš„å˜ä½“
            charVariants: {
                'a': ['@', '4', 'ï½', 'â“', 'â’œ', 'Î±', 'ğŸ…'],
                'b': ['8', 'ï½‚', 'â’', 'â“‘', 'á¸ƒ', 'á¸…', 'á¸‡', 'ğŸ…‘', 'ğŸ…±'],
                'c': ['ï½ƒ', 'â’', 'â“’', 'á¸‰', 'ğŸ…’'],
                'd': ['ï½„', 'â’Ÿ', 'â““', 'á¸‹', 'á¸', 'á¸', 'á¸‘', 'á¸“', 'ğŸ…“'],
                'e': ['3', 'ï½…', 'â’ ', 'â“”', 'á¸•', 'á¸—', 'á¸™', 'á¸›', 'á¸', 'ğŸ…”'],
                'f': ['ï½†', 'â’¡', 'â“•', 'á¸Ÿ', 'ğŸ…•'],
                'g': ['9', 'ï½‡', 'â’¢', 'â“–', 'á¸¡', 'ğŸ…–'],
                'h': ['ï½ˆ', 'â’£', 'â“—', 'á¸£', 'á¸¥', 'á¸§', 'á¸©', 'á¸«', 'ğŸ…—'],
                'i': ['1', '!', 'ï½‰', 'â’¤', 'â“˜', 'Ã¬', 'Ã­', 'Ã®', 'Ã¯', 'ğŸ…˜'],
                'j': ['ï½Š', 'â’¥', 'â“™', 'Äµ', 'ğŸ…™'],
                'k': ['ï½‹', 'â’¦', 'â“š', 'á¸±', 'á¸³', 'á¸µ', 'ğŸ…š'],
                'l': ['1', 'ï½œ', 'ï½Œ', 'â’§', 'â“›', 'á¸·', 'á¸¹', 'á¸»', 'á¸½', 'ğŸ…›'],
                'm': ['ï½', 'â’¨', 'â“œ', 'á¸¿', 'á¹', 'á¹ƒ', 'ğŸ…œ'],
                'n': ['ï½', 'â’©', 'â“', 'Å„', 'á¹‡', 'á¹…', 'á¹‰', 'á¹‹', 'ğŸ…'],
                'o': ['0', 'ï½', 'ã€‡', 'â’ª', 'â“', 'Ã²', 'Ã³', 'Ã´', 'Ã¶', 'ğŸ…'],
                'p': ['ï½', 'â’«', 'â“Ÿ', 'á¹•', 'á¹—', 'ğŸ…Ÿ'],
                'q': ['ï½‘', 'â’¬', 'â“ ', 'á¹™', 'á¹›', 'á¹', 'á¹Ÿ', 'ğŸ… '],
                'r': ['ï½’', 'â’­', 'â“¡', 'á¹™', 'á¹›', 'á¹', 'á¹Ÿ', 'ğŸ…¡'],
                's': ['5', 'ï½“', 'ï¼„', 'â’®', 'â“¢', 'Å›', 'á¹£', 'á¹¥', 'á¹§', 'á¹©', 'ğŸ…¢'],
                't': ['7', 'ï½”', 'ï¼‹', 'â’¯', 'â“£', 'á¹«', 'á¹­', 'á¹¯', 'á¹±', 'ğŸ…£'],
                'u': ['ï½•', 'â’°', 'â“¤', 'Ã¹', 'Ãº', 'Ã»', 'Ã¼', 'ğŸ…¤'],
                'v': ['ï½–', 'â’±', 'â“¥', 'á¹½', 'á¹¿', 'ğŸ…¥'],
                'w': ['ï½—', 'â’²', 'â“¦', 'áº', 'áºƒ', 'áº…', 'áº‡', 'áº‰', 'ğŸ…¦'],
                'x': ['Ã—', 'âœ•', 'âœ–', 'âœ—', 'âœ˜', 'ï½˜', 'â’³', 'â“§', 'áº‹', 'áº', 'ğŸ…§', 'X', 'ï¼¸'],
                'y': ['ï½™', 'â’´', 'â“¨', 'áº', 'áº™', 'á»³', 'Ã½', 'á»·', 'á»¹', 'ğŸ…¨'],
                'z': ['2', 'ï½š', 'â’µ', 'â“©', 'áº‘', 'áº“', 'áº•', 'ğŸ…©'],
                'å‚»': ['å„', 'sha', 'ï¼³ï¼¨ï¼¡', 's h a'],
                'é€¼': ['å±„', 'æ¯”', 'æ¯•', 'ç¬”', 'å¸', 'B', 'b', 'X', 'x', 'ï¼¢', 'ï½‚'],
                'æ­»': ['si', 'ï¼³', 'ï½“', 'ï¼³ï¼©', 's i'],
                'å¦ˆ': ['ma', 'ï½', 'ï¼­', 'ï¼­ï¼¡', 'm a'],
                'è›‹': ['dan', 'ï¼¤', 'ï¼¤ï¼¡ï¼®', 'd a n']
            },
            
            // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å˜ä½“
            generateVariants(word) {
                const variants = new Set([word]);
                
                // ç”Ÿæˆæ‹¼éŸ³å˜ä½“
                if (word.includes('å‚»')) {
                    variants.add(word.replace('å‚»', 'sha'));
                    variants.add(word.replace('å‚»', 'SHA'));
                    variants.add(word.replace('å‚»', 's h a'));
                }
                if (word.includes('é€¼')) {
                    variants.add(word.replace('é€¼', 'bi'));
                    variants.add(word.replace('é€¼', 'BI'));
                    variants.add(word.replace('é€¼', 'b i'));
                }
                if (word.includes('æ­»')) {
                    variants.add(word.replace('æ­»', 'si'));
                    variants.add(word.replace('æ­»', 'SI'));
                    variants.add(word.replace('æ­»', 's i'));
                }
                if (word.includes('å¦ˆ')) {
                    variants.add(word.replace('å¦ˆ', 'ma'));
                    variants.add(word.replace('å¦ˆ', 'MA'));
                    variants.add(word.replace('å¦ˆ', 'm a'));
                }
                if (word.includes('è›‹')) {
                    variants.add(word.replace('è›‹', 'dan'));
                    variants.add(word.replace('è›‹', 'DAN'));
                    variants.add(word.replace('è›‹', 'd a n'));
                }
                
                // ç”Ÿæˆç‰¹æ®Šå­—ç¬¦å˜ä½“
                for (const [char, replacements] of Object.entries(this.charVariants)) {
                    if (word.includes(char)) {
                        for (const replacement of replacements) {
                            variants.add(word.replace(new RegExp(char, 'g'), replacement));
                            // æ·»åŠ å¤§å°å†™å˜ä½“
                            variants.add(word.replace(new RegExp(char, 'g'), replacement.toLowerCase()));
                            variants.add(word.replace(new RegExp(char, 'g'), replacement.toUpperCase()));
                        }
                    }
                }
                
                // ç”Ÿæˆåˆ†éš”ç¬¦å˜ä½“ï¼ˆæ·»åŠ ç‰¹æ®Šå­—ç¬¦åˆ†éš”ï¼‰
                if (word.length > 1) {
                    const separators = ['', '-', '_', '.', '*', '&', '@', ' ', '~', '^', '%'];
                    for (const sep of separators) {
                        if (sep) {
                            // åœ¨æ¯ä¸ªå­—ç¬¦ä¹‹é—´æ·»åŠ åˆ†éš”ç¬¦
                            let variant = '';
                            for (let i = 0; i < word.length; i++) {
                                variant += word[i];
                                if (i < word.length - 1) variant += sep;
                            }
                            variants.add(variant);
                            
                            // æ·»åŠ å¤§å°å†™å˜ä½“
                            variants.add(variant.toLowerCase());
                            variants.add(variant.toUpperCase());
                        }
                    }
                }
                
                return Array.from(variants);
            },
            
            // è·å–æ‰€æœ‰è„è¯æ¨¡å¼
            getAllPatterns() {
                const patterns = [];
                
                for (const pattern of this.basePatterns) {
                    patterns.push(pattern); // åŸå§‹æ¨¡å¼
                    patterns.push(pattern.toLowerCase()); // å°å†™
                    patterns.push(pattern.toUpperCase()); // å¤§å†™
                    
                    // ç”Ÿæˆå˜ä½“
                    const variants = this.generateVariants(pattern);
                    for (const variant of variants) {
                        patterns.push(variant);
                        patterns.push(variant.toLowerCase());
                        patterns.push(variant.toUpperCase());
                    }
                }
                
                return patterns;
            },
            
            // æ£€æŸ¥æ–‡æœ¬æ˜¯å¦åŒ…å«è„è¯
            check(text) {
                const patterns = this.getAllPatterns();
                const lowerText = text.toLowerCase();
                
                for (const pattern of patterns) {
                    // ä½¿ç”¨æ›´ä¸¥æ ¼çš„åŒ¹é…
                    const patternLower = pattern.toLowerCase();
                    
                    // æ£€æŸ¥ç²¾ç¡®åŒ¹é…æˆ–ä½œä¸ºå•è¯çš„ä¸€éƒ¨åˆ†
                    if (lowerText.includes(patternLower)) {
                        return {
                            hasProfanity: true,
                            word: pattern,
                            message: `æ£€æµ‹åˆ°ä¸å½“ç”¨è¯­: ${pattern}`
                        };
                    }
                    
                    // æ£€æŸ¥ä½¿ç”¨ç©ºæ ¼æˆ–æ ‡ç‚¹åˆ†éš”çš„æƒ…å†µ
                    const regex = new RegExp(`(^|\\s|[^a-zA-Z0-9])${patternLower}(\\s|[^a-zA-Z0-9]|$)`, 'i');
                    if (regex.test(text)) {
                        return {
                            hasProfanity: true,
                            word: pattern,
                            message: `æ£€æµ‹åˆ°ä¸å½“ç”¨è¯­: ${pattern}`
                        };
                    }
                }
                
                return { hasProfanity: false };
            }
        };

        // æ£€æŸ¥é¢‘ç‡é™åˆ¶
        function checkRateLimit() {
            const now = Date.now();
            const oneMinuteAgo = now - 60000; // 1åˆ†é’Ÿå‰
            
            // ç§»é™¤1åˆ†é’Ÿå‰çš„è®°å½•
            requestTimestamps = requestTimestamps.filter(time => time > oneMinuteAgo);
            
            // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
            if (requestTimestamps.length >= MAX_REQUESTS_PER_MINUTE) {
                const secondsLeft = Math.ceil((requestTimestamps[0] + 60000 - now) / 1000);
                return {
                    allowed: false,
                    message: `å‘é€é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç­‰å¾…${secondsLeft}ç§’åå†è¯•`
                };
            }
            
            // æ·»åŠ å½“å‰æ—¶é—´æˆ³
            requestTimestamps.push(now);
            return { allowed: true };
        }

        // æ›´æ–°å­—ç¬¦è®¡æ•°
        function updateCharCount() {
            const messageInput = document.getElementById('messageInput');
            const charCount = document.getElementById('charCount');
            const notifyBtn = document.getElementById('notifyBtn');
            const currentLength = messageInput.value.length;
            
            charCount.textContent = `${currentLength}/200`;
            
            // å¯ç”¨/ç¦ç”¨å‘é€æŒ‰é’®
            notifyBtn.disabled = currentLength === 0 || currentLength > 200;
            
            // æ”¹å˜å­—ç¬¦è®¡æ•°é¢œè‰²
            if (currentLength > 200) {
                charCount.classList.add('warning');
            } else {
                charCount.classList.remove('warning');
            }
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatusMessage(message, isSuccess) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = isSuccess ? 'status-message success' : 'status-message error';
            statusElement.style.display = 'block';
            
            // 3ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }
        
        // ä½¿ç”¨æ¨¡æ¿æ¶ˆæ¯
        function useTemplate(template) {
            const messageInput = document.getElementById('messageInput');
            
            if (messageTemplates[template]) {
                messageInput.value = messageTemplates[template];
                updateCharCount();
                
                // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.template-btn').forEach(btn => {
                    if (btn.dataset.template === template) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }
        
        // è°ƒç”¨Netlify Functionå‘é€é’‰é’‰é€šçŸ¥
        async function notifyOwner() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) {
                showStatusMessage('è¯·è¾“å…¥é€šçŸ¥å†…å®¹', false);
                return;
            }
            
            if (message.length > 200) {
                showStatusMessage('é€šçŸ¥å†…å®¹ä¸èƒ½è¶…è¿‡200å­—', false);
                return;
            }

            // æ£€æŸ¥è„è¯
            const profanityCheck = profanityFilter.check(message);
            if (profanityCheck.hasProfanity) {
                showStatusMessage(profanityCheck.message, false);
                return;
            }

            // æ£€æŸ¥é¢‘ç‡é™åˆ¶
            const rateLimitCheck = checkRateLimit();
            if (!rateLimitCheck.allowed) {
                showStatusMessage(rateLimitCheck.message, false);
                return;
            }

            const notifyBtn = document.getElementById('notifyBtn');
            notifyBtn.disabled = true;
            notifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å‘é€ä¸­...';

            try {
                // å®é™…å‘é€è¯·æ±‚ - æ›¿æ¢ä¸ºæ‚¨çš„Netlify Functionç«¯ç‚¹
                const response = await fetch('/.netlify/functions/dingtalk-notification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        message,
                        phoneNumber: "" // å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ç”µè¯å·ç 
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showStatusMessage('é’‰é’‰é€šçŸ¥å‘é€æˆåŠŸï¼', true);
                    notifyBtn.innerHTML = '<i class="fas fa-check"></i> å‘é€æˆåŠŸ';
                    
                    // ä¸é‡ç½®æ¶ˆæ¯å†…å®¹ï¼Œä¿æŒå½“å‰çŠ¶æ€
                    updateCharCount();
                    
                    setTimeout(() => {
                        notifyBtn.innerHTML = '<i class="fas fa-paper-plane"></i> å‘é€é’‰é’‰é€šçŸ¥';
                        notifyBtn.disabled = false;
                    }, 2000);
                } else {
                    console.error("å‘é€é€šçŸ¥å¤±è´¥", data);
                    showStatusMessage(`å‘é€å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, false);
                    notifyBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> å‘é€å¤±è´¥';
                    
                    setTimeout(() => {
                        notifyBtn.innerHTML = '<i class="fas fa-paper-plane"></i> å‘é€é’‰é’‰é€šçŸ¥';
                        notifyBtn.disabled = false;
                    }, 2000);
                }
            } catch (error) {
                console.error("å‘é€é€šçŸ¥å¤±è´¥", error);
                showStatusMessage('å‘é€é€šçŸ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', false);
                notifyBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> å‘é€å¤±è´¥';
                
                setTimeout(() => {
                    notifyBtn.innerHTML = '<i class="fas fa-paper-plane"></i> å‘é€é’‰é’‰é€šçŸ¥';
                    notifyBtn.disabled = false;
                }, 2000);
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            
            // åˆå§‹åŒ–æ¶ˆæ¯è¾“å…¥ç›‘å¬
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', updateCharCount);
            
            // åˆå§‹åŒ–æ¨¡æ¿æŒ‰é’®
            const templateButtons = document.querySelectorAll('.template-btn');
            templateButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    useTemplate(btn.dataset.template);
                });
            });
            
            // åˆå§‹åŒ–å‘é€æŒ‰é’®
            const notifyBtn = document.getElementById('notifyBtn');
            notifyBtn.addEventListener('click', (e) => {
                e.preventDefault();
                notifyOwner();
            });
            
            // åˆå§‹åŒ–æ‹¨æ‰“ç”µè¯æŒ‰é’®
            const callBtn = document.getElementById('callBtn');
            callBtn.addEventListener('click', (e) => {
                e.preventDefault();
                window.location.href = 'tel:13516875426'; // æ›¿æ¢ä¸ºå®é™…ç”µè¯å·ç 
            });
            
            // åˆå§‹åŒ–é»˜è®¤æ¶ˆæ¯
            useTemplate('default');
        });
    </script>
</body>
</html>
